{% extends 'base.html' %}

{% set page_title = post.title %}
{% set base_url = request.META.HTTP_HOST %}

{% if FACEBOOK_ID %}
  {% block js %}
  <script type="text/javascript">
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '{{ FACEBOOK_ID }}',
        xfbml      : true,
        version    : 'v2.1'
      });
    };

    (function(d, s, id){
       var js, fjs = d.getElementsByTagName(s)[0];
       if (d.getElementById(id)) {return;}
       js = d.createElement(s); js.id = id;
       js.src = "//connect.facebook.net/fr_FR/sdk.js";
       fjs.parentNode.insertBefore(js, fjs);
     }(document, 'script', 'facebook-jssdk'));

  </script>
  {% endblock %}

  {% block meta %}
  <meta property="fb:app_id"  content="{{ FACEBOOK_ID }}" /> 
  <meta property="og:site_name"    content="RunReport" /> 
  <meta property="og:type"    content="website" /> 
  <meta property="og:url"     content="https://{{ base_url }}{% url 'post' post.writer.username, post.slug %}" /> 
  <meta property="og:title"   content="{{ post.title }}" /> 
  <meta property="og:description"   content="{{ post.html|striptags|truncatechars(200) }}" /> 
  <meta property="og:image"   content="https://{{ base_url }}{{ post.writer.avatar.url }}" /> 
  {% endblock %}
{% endif %}
{% block content %}
<div class="container">
  <h1>{{ post.title }}</h1>

  <div class="row">
    <div class="col-xs-1">
      <img class="img-responsive img-rounded" src="{{ post.writer.avatar.url }}" />
    </div>
    <div class="col-xs-8">
      <span class="lead">
        {{ _('Written by') }}
        <a href="{% url user-public-profile post.writer.username %}">
          {{ post.writer.first_name }} {{ post.writer.last_name }}
        </a>
        {% if not post.published %}
          <span class="label label-danger">{{ _('Not published') }}</span>
        {% endif %}
      </span>
      <p>
        {{ _('on') }} {{ post.created|date('l d E Y') }}
      </p>
    </div>
    <div class="col-xs-3 text-right">
      <div class="fb-like" data-href="https://{{ base_url }}{% url 'post' post.writer.username, post.slug %}" data-width="200" data-layout="button" data-action="like" data-show-faces="false" data-share="true"></div>

      {% if user == post.writer %}
      <a href="{% url 'post-edit' post.slug %}" class="btn btn-info">
        {{ _('Edit') }}
      </a>
      {% endif %}
    </div>
  </div>

  <hr />

  <div class="row">
    {% with post.sessions.all() as sessions %}
      <div class="{% if sessions %}col-sm-8{% else %}col-sm-12{% endif %} col-xs-12">
        {{ post.html|safe }}
      </div>
      {% if sessions %}
      <div class="col-sm-4 col-xs-12">
        <h4>{{ _('%d sport sessions') % sessions.count() }}</h4>
        {% for s in sessions %}
        <p>
          <span class="type {{ s.type }} do-tooltip" title="{{ _(s.type|title) }}"></span>
          <i class="icon-sport-{{ s.sport.slug }} do-tooltip" title="{{ _(s.sport.name) }}"></i>
          {% if s.track %}
          <i class="icon-location do-tooltip" title="{{ s.track.provider|title }}"></i>
          {% endif %}
          <a href="{% url 'user-calendar-day' post.writer.username, s.day.date.year, s.day.date.month, s.day.date.day %}">
            {{ s.name }}
          </a>
        </p>
        {% endfor %}
      </div>
      {% endif %}
    {% endwith %}
  </div>
</div>
{% endblock %}
