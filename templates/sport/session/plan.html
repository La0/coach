
<script type="text/javascript">
$(function(){
  $('#move_{{ session.pk }}').datepicker({
    language : '{{ user.language }}',
    todayHighlight : true,
    weekStart : 1,
  }).on('changeDate', function(evt){
    if(!evt.date)
      return;
    var data = {
      psa : {{ session.plan_session.pk }},
      date : Math.floor(evt.date.getTime() / 1000),
    };
    load_box('{% url 'plan-session-move' %}', 'POST', data);
  });
});
</script>

{% with session.plan_session.plan_session as psess %}
<div class="form-group row plan-status ">
  <label class="control-label col-sm-2 hidden-xs">
    {{ _('Training plan') }}
    <a href="{% url 'plan' psess.plan.pk %}">
      {{ psess.plan.name }}
    </a>
  </label>
  <div class="col-xs-4 col-sm-1">
    {% with session.plan_session.status as status %}
    <div class="dropdown">
      <button class="btn btn-sm btn-primary dropdown-toggle {{ status }}" data-toggle="dropdown">
        <span class="name">
          {{ _(status|title()) }}
        </span>
        <span class="caret"></span>
      </button>
      {% with form.plan_status.field.choices as choices %}
      <ul class="dropdown-menu plan-status">
        {% for k, name in choices %}
        <li{% if status == k %} class="active"{% endif %}>
          <a href="#" value="{{k}}">{{ _(name) }}</a>
        </li>
        {% endfor %}
        {{ form.plan_status|safe }}
      </ul>
      {% endwith %}
    </div>
    {% endwith %}
  </div>
  <div class="col-xs-8 col-sm-7 details">
    <p>
      <strong>{{ psess.name }}</strong>
    </p>
    <p>
      <i class="icon-sport-{{ psess.sport.slug }}"></i>
      {% with psess.plan.creator as trainer %}
      <a href="{% url 'user-public-profile' trainer.username %}" target="_blank">
        {{ trainer.first_name }} {{ trainer.last_name }}
      </a>
      {% endwith %}
      {{ _('has planned a ') }} {{ _(psess.type|title) }}
      {{ _(psess.sport.name) }}

      {% if psess.time and psess.time != session.time %}
      <span class="text-muted">&bull;</span>
      {{ psess.time }}
      {% endif %}

      {% if psess.distance and psess.distance != session.distance %}
      <span class="text-muted">&bull;</span>
      {{ psess.distance }} km
      {% endif %}
    </p>
  </div>
  <div class="col-sm-2 hidden-xs text-right">
    <button id="move_{{ session.pk }}" type="button" class="btn btn-light btn-info btn-sm" data-date="{{ session.day.date }}" data-date-format="yyyy-mm-dd">
      <i class="icon-edit"></i>
      {{ _('Change date') }}
    </button>
  </div>
  {% if form.plan_status.errors %}
  <div class="alert alert-danger col-sm-offset-2 col-xs-12 col-sm-10">
    {{form.plan_status.errors|safe}}
  </div>
  {% endif %}
</div>
{% endwith %}
